

// mainTaskEntry

const log_conversation = (history: any[]) => (src: string, text: string) => {
    // timestamp = time.time()
    // if source not in self.history.keys():
    //     # an exception
    //     source = "exception"
    // self.history[source].append((timestamp, text))
}



const requestopt_help_handler = () => {
    // console.log(new mainTaskCompleter().taskDetails);
}
const requestopt_quit_handler = () => {
    console.log("Thank you for using PentestGPT!");
    log_conversation([])("pentestGPT", "Thank you for using PentestGPT!");
    return false;
}
const requestopt_next_handler = () => {
    // (1) pass the information to input_parsing session.
    const options = Object.keys(this.postfixOptions);
    const optDesc = Object.values(this.optionsDesc);

    const valueList = options.map((opt, i) => ({
        index: i,
        label: `${opt} ${optDesc[i]}`
    }));

    const source = await promptSelect(
        "Please choose the source of the information.",
        valueList
    );

    console.log("Your input: (End with <shift + right-arrow>)");
    const userInput = await promptAsk("> ", { multiline: true });

    this.logConversation(
        "user",
        `Source: ${options[source]}\n${userInput}`
    );

    console.log("PentestGPT Thinking...");
    const parsedInput = await this.inputParsingHandler(
        userInput,
        options[source]
    );

    const reasoningResponse = await this.reasoningHandler(parsedInput);
    this.stepReasoningResponse = reasoningResponse;

    console.log(
        "Based on the analysis, the following tasks are recommended:"
    );
    console.log(reasoningResponse + "\n");

    this.logConversation(
        "pentestGPT",
        "Based on the analysis, the following tasks are recommended:" +
        reasoningResponse
    );

    return reasoningResponse;
}
const requestopt_more_handler = () => { }
const requestopt_todo_handler = () => { }
const requestopt_discuss_handler = () => { }
const requestopt_google_handler = () => {
    // console.log("Please enter your search query. PentestGPT will summarize the info from google. (End with <shift + right-arrow>) ")
    log_conversation([])(
        "pentestGPT","Please enter your search query. PentestGPT will summarize the info from google.",
    )

    user_input = prompt_ask("Your input: ", multiline=False)
    log_conversation([])("user", user_input)
    
    with self.console.status("[bold green] PentestGPT Thinking...") as status:
        result: dict = google_search(user_input, 5)  # 5 results by default
        response = "Google search results:\n" + "still under development."

    self.console.print(response + "\n", style="yellow")
    
    self.log_conversation("pentestGPT", response)
    
    return response
}


const handle = (requestOption: string) => {
    if (requestOption == 'help') requestopt_help_handler();
    if (requestOption == 'next') requestopt_next_handler();

    else if (requestOption == 'next') requestopt_next_handler();
    else if (requestOption == 'next') requestopt_next_handler();
    else if (requestOption == 'next') requestopt_next_handler();
    else if (requestOption == 'next') requestopt_next_handler();
    else if (requestOption == 'next') requestopt_next_handler();
}

const main = () => {
    // session lifecycle

    const request_opt = 'next';

    handle(request_opt);
}